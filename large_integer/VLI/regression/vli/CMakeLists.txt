add_definitions (-DBOOST_TEST_DYN_LINK -Wno-unused-variable)

# Make sure the linker can find the vli library once it is built. 
link_directories (${PROJECT_BINARY_DIR}/src/vli) 


set(VLI_FUZZ_TEST_ITERATIONS "10000" CACHE STRING "Number of fuzz iterations for the fuzz tests") 

set(tests constructors equal bit_shift negate plus plus_negative minus multiplies multiplies_negative divides modulo gmp_and_str_conversion gmp_plus gmp_minus gmp_multiplies_int gmp_multiplies gmp_divides  comparison misc_tests )
set(fuzz_tests constructors bit_shift negate plus plus_negative minus multiplies multiplies_negative divides modulo gmp_and_str_conversion gmp_plus gmp_minus gmp_multiplies_int gmp_multiplies gmp_divides )
set(extending_plus_tests gmp_extending_plus)
set(extending_multiplies_tests gmp_extending_multiplies gmp_extending_multiplies_negative gmp_extending_multiplie_add)
set(extending_karatsuba_tests gmp_karatsuba_extending_multiplies)
set(large_gmp_tests gmp_large_plus) 

set(test_sizes 128 192 256 384 448 512)
set(extending_plus_sizes 128 192 256 384 448)
set(extending_multiplies_sizes 128 192 256)
set(extending_karatsuba_sizes 128 256)
#set(large_gmp_sizes 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24)

#foreach(test ${large_gmp_tests})
#    foreach(size ${large_gmp_sizes})
#        add_executable(${test}_${size}_fuzz_test ${test}.cpp)
#        SET_TARGET_PROPERTIES(${test}_${size}_fuzz_test PROPERTIES COMPILE_FLAGS "-DVLI_SIZE=${size} -DVLI_FUZZ_TESTS")
#        target_link_libraries(${test}_${size}_fuzz_test ${Boost_LIBRARIES} ${GMP_LIBRARY_CXX} vli ${OpenMP_CXX_FLAGS})
#        add_test(${test}_${size}_fuzz_test ${test}_${size}_fuzz_test  ${VLI_FUZZ_TEST_ITERATIONS})
#    endforeach(size)
#endforeach(test)

foreach(test ${tests})
    foreach(size ${test_sizes})
        add_executable(${test}_${size}_test ${test}.cpp)
        SET_TARGET_PROPERTIES(${test}_${size}_test PROPERTIES COMPILE_FLAGS "-DVLI_SIZE=${size}")
        target_link_libraries(${test}_${size}_test ${Boost_LIBRARIES} ${GMP_LIBRARY_CXX} vli ${OpenMP_CXX_FLAGS})
        add_test(${test}_${size}_test ${test}_${size}_test)
    endforeach(size)
endforeach(test)

foreach(test ${fuzz_tests})
    foreach(size ${test_sizes})
        add_executable(${test}_${size}_fuzz_test ${test}.cpp)
        SET_TARGET_PROPERTIES(${test}_${size}_fuzz_test PROPERTIES COMPILE_FLAGS "-DVLI_SIZE=${size} -DVLI_FUZZ_TESTS")
        target_link_libraries(${test}_${size}_fuzz_test ${Boost_LIBRARIES} ${GMP_LIBRARY_CXX} vli ${OpenMP_CXX_FLAGS})
        add_test(${test}_${size}_fuzz_test ${test}_${size}_fuzz_test ${VLI_FUZZ_TEST_ITERATIONS} )
    endforeach(size)
endforeach(test)

foreach(test ${extending_plus_tests})
    foreach(size ${extending_plus_sizes})
        add_executable(${test}_${size}_test ${test}.cpp)
        SET_TARGET_PROPERTIES(${test}_${size}_test PROPERTIES COMPILE_FLAGS "-DVLI_SIZE=${size}")
        target_link_libraries(${test}_${size}_test ${Boost_LIBRARIES} ${GMP_LIBRARY_CXX} vli ${OpenMP_CXX_FLAGS})
        add_test(${test}_${size}_test ${test}_${size}_test)
    endforeach(size)
endforeach(test)

foreach(test ${extending_plus_tests})
    foreach(size ${extending_plus_sizes})
        add_executable(${test}_${size}_fuzz_test ${test}.cpp)
        SET_TARGET_PROPERTIES(${test}_${size}_fuzz_test PROPERTIES COMPILE_FLAGS "-DVLI_SIZE=${size} -DVLI_FUZZ_TESTS")
        target_link_libraries(${test}_${size}_fuzz_test ${Boost_LIBRARIES} ${GMP_LIBRARY_CXX} vli ${OpenMP_CXX_FLAGS})
        add_test(${test}_${size}_fuzz_test ${test}_${size}_fuzz_test ${VLI_FUZZ_TEST_ITERATIONS} )
    endforeach(size)
endforeach(test)

foreach(test ${extending_multiplies_tests})
    foreach(size ${extending_multiplies_sizes})
        add_executable(${test}_${size}_test ${test}.cpp)
        SET_TARGET_PROPERTIES(${test}_${size}_test PROPERTIES COMPILE_FLAGS "-DVLI_SIZE=${size}")
        target_link_libraries(${test}_${size}_test ${Boost_LIBRARIES} ${GMP_LIBRARY_CXX} vli ${OpenMP_CXX_FLAGS})
        add_test(${test}_${size}_test ${test}_${size}_test)
    endforeach(size)
endforeach(test)

foreach(test ${extending_multiplies_tests})
    foreach(size ${extending_multiplies_sizes})
        add_executable(${test}_${size}_fuzz_test ${test}.cpp)
        SET_TARGET_PROPERTIES(${test}_${size}_fuzz_test PROPERTIES COMPILE_FLAGS "-DVLI_SIZE=${size} -DVLI_FUZZ_TESTS")
        target_link_libraries(${test}_${size}_fuzz_test ${Boost_LIBRARIES} ${GMP_LIBRARY_CXX} vli ${OpenMP_CXX_FLAGS})
        add_test(${test}_${size}_fuzz_test ${test}_${size}_fuzz_test ${VLI_FUZZ_TEST_ITERATIONS} )
    endforeach(size)
endforeach(test)


foreach(test ${extending_karatsuba_tests})
    foreach(size ${extending_karatsuba_sizes})
        add_executable(${test}_${size}_fuzz_test ${test}.cpp)
        SET_TARGET_PROPERTIES(${test}_${size}_fuzz_test PROPERTIES COMPILE_FLAGS "-DVLI_SIZE=${size} -DVLI_FUZZ_TESTS")
        target_link_libraries(${test}_${size}_fuzz_test ${Boost_LIBRARIES} ${GMP_LIBRARY_CXX} vli ${OpenMP_CXX_FLAGS})
        add_test(${test}_${size}_fuzz_test ${test}_${size}_fuzz_test  ${VLI_FUZZ_TEST_ITERATIONS})
    endforeach(size)
endforeach(test)
